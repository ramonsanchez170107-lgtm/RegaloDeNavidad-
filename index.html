<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Regalo para Dana ‚ù§Ô∏è</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Montserrat:wght@300;500&display=swap" rel="stylesheet">
<style>
  * { margin:0; padding:0; box-sizing:border-box; }
  body { font-family: 'Montserrat', sans-serif; overflow-x: hidden; color:white; min-height:100vh; background:#000; position:relative;}
  .container { position: relative; z-index:2; max-width:600px; margin:auto; padding:20px; text-align:center; }
  h1 { font-family: 'Great Vibes', cursive; font-size:2.8rem; margin-bottom:10px; text-shadow:2px 2px 5px #000; }
  #phraseBox { font-size:1.2rem; margin:15px 0; min-height:100px; position:relative; text-shadow:1px 1px 3px #000; }
  img.landscape { width:100%; max-height:300px; object-fit:cover; border-radius:20px; margin-bottom:15px; display:none; box-shadow:0 0 25px rgba(255,200,220,0.5);}
  .controls { display:flex; gap:10px; justify-content:center; flex-wrap:wrap; }
  button { background:#c9184a; border:none; padding:12px 20px; border-radius:40px; color:white; font-size:1rem; cursor:pointer; margin-top:10px; transition:0.2s; }
  button[disabled] { opacity:.5; cursor:not-allowed; }
  button:hover:not([disabled]) { background:#ff4d6d; }

  /* Animaciones: Corazones, Nieve */
  .heart { position:absolute; color:#ff8fab; font-size:20px; animation: float 6s linear infinite; z-index:1; pointer-events:none;}
  @keyframes float { 0%{transform:translateY(100vh); opacity:1;} 100%{transform:translateY(-10vh); opacity:0;} }
  .snow { position:absolute; top:-10px; background:white; border-radius:50%; opacity:0.8; animation:snowFall linear infinite; z-index:1; pointer-events:none;}
  @keyframes snowFall { to{ transform:translateY(110vh); } }

  /* Animalitos */
  .animal { position:absolute; bottom:20px; width:50px; height:50px; z-index:3; animation: walk 8s linear forwards; pointer-events:none; }
  @keyframes walk { 0% { left:-60px; } 100% { left:100%; } }

  /* Mapa animado */
  #map { position:fixed; top:0; left:0; width:100%; height:100%; z-index:0; }
  #line { stroke:red; stroke-width:3; stroke-dasharray:10; fill:none; stroke-linecap:round; animation: dash 4s linear forwards; }
  @keyframes dash { from { stroke-dashoffset:1000; } to { stroke-dashoffset:0; } }

  /* Loading overlay */
  #loading { position:fixed; inset:0; background:rgba(0,0,0,0.7); color:white; display:flex; align-items:center; justify-content:center; z-index:10; font-size:1.2rem; }
  #loading.hidden { display:none; }

  /* Respect reduced motion */
  @media (prefers-reduced-motion: reduce) {
    .heart, .snow, .animal, #line { animation: none !important; transition: none !important; }
  }
</style>
</head>
<body>

<!-- Mapa animado -->
<svg id="map" aria-hidden="true" focusable="false">
  <image href="https://upload.wikimedia.org/wikipedia/commons/thumb/1/12/USA_map_blank.svg/1200px-USA_map_blank.svg.png" width="100%" height="100%"/>
  <line id="line" x1="200" y1="100" x2="500" y2="400"/>
</svg>

<div id="loading" role="status" aria-live="polite">Cargando... por favor espera</div>

<div class="container">
  <h1>Feliz Navidad, Dana üéÑ‚ù§Ô∏è</h1>
  <div id="phraseBox" aria-live="polite" role="status"></div>
  <img id="landscape" class="landscape" src="" alt="Paisaje rom√°ntico">
  <div class="controls">
    <button id="prevBtn" aria-label="Frase anterior">Anterior</button>
    <button id="nextBtn" aria-label="Siguiente frase">Siguiente</button>
    <button id="muteBtn" aria-label="Alternar m√∫sica">üîä Mute</button>
  </div>
  <p style="font-size:.9rem; margin-top:10px; opacity:.9">Atajos: ‚Üê Anterior ¬∑ ‚Üí Siguiente ¬∑ Espacio/Enter Siguiente ¬∑ M tecla para silenciar</p>
</div>

<audio id="music" loop>
  <source src="https://cdn.pixabay.com/download/audio/2022/12/01/audio_6e6faef2f7.mp3" type="audio/mpeg">
</audio>

<script>
  // Slides: frase + imagen + animalito
  const slides = [
    {
      phrase: "Dana, incluso cuando estamos lejos, te siento cerca ‚ù§Ô∏è",
      img: "https://images.unsplash.com/photo-1506744038136-46273834b3fb?crop=entropy&cs=tinysrgb&fit=max&h=300&w=600&q=80",
      animal: "https://i.imgur.com/8Km9tLL.png"
    },
    {
      phrase: "Cada noche hablando contigo es mi momento favorito üåü",
      img: "https://images.unsplash.com/photo-1475721027785-f74eccf877e2?crop=entropy&cs=tinysrgb&fit=max&h=300&w=600&q=80",
      animal: "https://i.imgur.com/L0y7F9B.png"
    },
    {
      phrase: "Desde Chicago hasta Guadalajara, mi coraz√≥n siempre sabe d√≥nde pertenece üíå",
      img: "https://images.unsplash.com/photo-1482192596544-9eb780fc7f66?crop=entropy&cs=tinysrgb&fit=max&h=300&w=600&q=80",
      animal: "https://i.imgur.com/4AiXzf8.png"
    },
    {
      phrase: "Gracias por volver a elegirme, gracias por estar conmigo üíñ",
      img: "https://images.unsplash.com/photo-1507525428034-b723cf961d3e?crop=entropy&cs=tinysrgb&fit=max&h=300&w=600&q=80",
      animal: "https://i.imgur.com/N7rlQYt.png"
    },
    {
      phrase: "Merry Christmas, babe üéÑ‚ù§Ô∏è",
      img: "https://images.unsplash.com/photo-1458165492546-9f8d4c0b6f95?crop=entropy&cs=tinysrgb&fit=max&h=300&w=600&q=80",
      animal: "https://i.imgur.com/L0y7F9B.png"
    }
  ];

  const phraseBox = document.getElementById("phraseBox");
  const landscape = document.getElementById("landscape");
  const nextBtn = document.getElementById("nextBtn");
  const prevBtn = document.getElementById("prevBtn");
  const muteBtn = document.getElementById("muteBtn");
  const loadingDiv = document.getElementById("loading");
  const music = document.getElementById("music");

  let currentIndex = 0;
  let typingTimeout = null;
  let typingCancelled = false;

  // Preload images and animal icons
  function preloadImages(urls) {
    const promises = urls.map(url => new Promise((resolve) => {
      const img = new Image();
      img.onload = () => resolve({ url, status: 'ok' });
      img.onerror = () => resolve({ url, status: 'error' });
      img.src = url;
    }));
    return Promise.all(promises);
  }

  const allImageUrls = slides.flatMap(s => [s.img, s.animal]);
  preloadImages(allImageUrls).then(() => {
    // hide loading when preloads complete
    loadingDiv.classList.add('hidden');
    // show first slide once preloaded
    showSlide(0);
    // try autoplay (may fail if browser blocks)
    music.play().catch(()=>{});
    updateControls();
  });

  // Show slide with typewriter effect
  function showSlide(index) {
    if (index < 0 || index >= slides.length) return;
    // cancel any ongoing typing
    typingCancelled = true;
    if (typingTimeout) { clearTimeout(typingTimeout); typingTimeout = null; }
    typingCancelled = false;

    currentIndex = index;
    phraseBox.innerHTML = "";
    landscape.style.display = "block";
    landscape.src = slides[index].img;
    landscape.alt = "Paisaje rom√°ntico " + (index+1);

    // Typewriter
    const text = slides[index].phrase;
    let i = 0;
    function typeWriter() {
      if (typingCancelled) return;
      if (i < text.length) {
        phraseBox.innerHTML += text.charAt(i);
        i++;
        typingTimeout = setTimeout(typeWriter, 40);
      } else {
        typingTimeout = null;
      }
    }
    typeWriter();

    // Animalito
    const animalImg = document.createElement("img");
    animalImg.src = slides[index].animal;
    animalImg.className = "animal";
    animalImg.alt = ""; // decorative
    // remove any existing animals so they don't stack up too much
    document.querySelectorAll('.animal').forEach(a => a.remove());
    document.body.appendChild(animalImg);
    // Remove after animation duration (slightly longer than CSS)
    const removeAfter = 8200;
    setTimeout(() => { animalImg.remove(); }, removeAfter);

    updateControls();
  }

  function nextSlide() {
    if (currentIndex < slides.length - 1) {
      showSlide(currentIndex + 1);
    }
  }
  function prevSlide() {
    if (currentIndex > 0) {
      showSlide(currentIndex - 1);
    }
  }

  nextBtn.addEventListener("click", () => nextSlide());
  prevBtn.addEventListener("click", () => prevSlide());

  // Keyboard navigation
  document.addEventListener("keydown", (e) => {
    // do not trap keys when typing into an input or textarea
    const active = document.activeElement;
    if (active && (active.tagName === 'INPUT' || active.tagName === 'TEXTAREA' || active.isContentEditable)) return;

    if (e.key === "ArrowRight") {
      e.preventDefault();
      nextSlide();
    } else if (e.key === "ArrowLeft") {
      e.preventDefault();
      prevSlide();
    } else if (e.key === " " || e.key === "Spacebar" || e.key === "Enter") {
      // space/enter -> next
      // allow default when focused on a button (so it still activates), otherwise prevent default scrolling on space
      if (active && active.tagName === 'BUTTON') return;
      e.preventDefault();
      nextSlide();
    } else if (e.key.toLowerCase() === 'm') {
      // toggle mute
      toggleMute();
    }
  });

  // Music control
  function toggleMute() {
    music.muted = !music.muted;
    updateMuteLabel();
    if (!music.muted) {
      music.play().catch(()=>{});
    }
  }

  muteBtn.addEventListener("click", toggleMute);

  function updateMuteLabel() {
    // When not muted, label is "üîä Mute" (clicking will mute). When muted, label is "üîá Unmute".
    muteBtn.innerText = music.muted ? "üîá Unmute" : "üîä Mute";
  }

  // Initialize label properly
  music.muted = false;
  updateMuteLabel();

  // Update previous/next button disabled state
  function updateControls() {
    prevBtn.disabled = (currentIndex === 0);
    nextBtn.disabled = (currentIndex === slides.length - 1);
    // hide next if last (visual choice)
    nextBtn.style.display = (currentIndex === slides.length - 1) ? "none" : "";
    prevBtn.style.display = (currentIndex === 0) ? "none" : "";
  }

  // Hearts and snow effects (kept from original)
  setInterval(()=>{
    const heart = document.createElement("div");
    heart.className = "heart"; heart.innerHTML = "‚ù§Ô∏è";
    heart.style.left = Math.random() * 100 + "vw";
    heart.style.fontSize = (Math.random() * 18 + 14) + "px";
    document.body.appendChild(heart);
    setTimeout(()=>heart.remove(), 6000);
  }, 400);

  setInterval(()=>{
    const snow = document.createElement("div");
    snow.className = "snow"; snow.style.left = Math.random() * 100 + "vw";
    const size = Math.random() * 5 + 4;
    snow.style.width = size + "px";
    snow.style.height = size + "px";
    snow.style.animationDuration = (Math.random() * 6 + 4) + "s";
    document.body.appendChild(snow);
    setTimeout(()=>snow.remove(), 10000);
  }, 200);

</script>
</body>
</html>
